<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>12to12 News Radar</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Custom Styles -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #e0f2fe;
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        /* Simple spinner animation */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #09f;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-2H2JH0HKZ5"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-2H2JH0HKZ5');
    </script>
</head>
<body class="antialiased text-gray-800">

    <!-- Main Container -->
    <div class="container mx-auto p-4 md:p-8 max-w-4xl">

        <!-- Header Section -->
        <header class="mb-8 text-center">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-2">12to12 News Radar</h1>
            <p class="text-gray-600">The latest global headlines, updated every minute.</p>
            <div id="last-updated" class="text-sm text-gray-500 mt-2"></div>
        </header>

        <!-- Search Bar -->
        <div class="mb-8">
            <input type="text" id="search-input" placeholder="Search for news..." class="w-full px-4 py-3 border border-gray-300 rounded-full shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
        </div>

        <!-- Loading Spinner -->
        <div id="loader" class="flex justify-center items-center py-10">
            <div class="spinner"></div>
        </div>
        
        <!-- Today's News Feed Container -->
        <main id="news-feed" class="space-y-6">
            <!-- News articles will be injected here by JavaScript -->
        </main>

        <!-- Yesterday's News Section -->
        <div class="mt-12 text-center">
            <a href="#" id="toggle-yesterday" class="text-blue-600 font-semibold hover:underline">What we shared Yesterday</a>
            <div id="yesterday-news-container" class="hidden mt-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Yesterday's News</h2>
                <div id="yesterday-news-feed" class="space-y-6">
                    <!-- Yesterday's news will be injected here -->
                </div>
            </div>
        </div>

    </div>
    
    <!-- Footer Section -->
    <footer class="text-center py-6">
        <p class="text-sm text-gray-500 mb-2">Created by Maria Manuel</p>
    </footer>


    <!-- JavaScript Logic -->
    <script>
        // DOM Element References
        const newsFeed = document.getElementById('news-feed');
        const yesterdayNewsFeed = document.getElementById('yesterday-news-feed');
        const loader = document.getElementById('loader');
        const lastUpdatedElement = document.getElementById('last-updated');
        const searchInput = document.getElementById('search-input');
        const toggleYesterdayBtn = document.getElementById('toggle-yesterday');
        const yesterdayContainer = document.getElementById('yesterday-news-container');

        // --- State Management ---
        let todaysArticles = [];
        let yesterdaysArticles = [];
        let searchTerm = '';

        // --- Configuration ---
        const RSS_PROXY_URL = 'https://api.rss2json.com/v1/api.json?rss_url=';
        const REFRESH_INTERVAL = 60000; // 1 minute

        const NEWS_SOURCES = [
            'http://feeds.reuters.com/reuters/topNews', 'http://feeds.bbci.co.uk/news/world/rss.xml', 
            'http://rss.cnn.com/rss/cnn_world.rss', 'https://www.france24.com/en/rss', 
            'https://apnews.com/hub/ap-top-news/rss', 'https://www.theguardian.com/world/rss', 
            'https://news.google.com/rss?hl=en-IN&gl=IN&ceid=IN:en', 'http://feeds.nbcnews.com/nbcnews/public/news',
            'https://timesofindia.indiatimes.com/rssfeeds/296589292.cms', 'https://www.hindustantimes.com/rss/topnews/rssfeed.xml',
            'https://feeds.feedburner.com/ndtvnews-top-stories', 'https://www.thehindu.com/feeder/default.rss',
            'https://www.indiatoday.in/rss/home', 'https://indianexpress.com/section/india/feed/',
            'https://www.news18.com/rss/india.xml', 'https://economictimes.indiatimes.com/rssfeedstopstories.cms',
            'https://www.livemint.com/rss/news', 'https://feeds.feedburner.com/ndtvprofit-latest'
        ];

        /**
         * Fetches, filters, and displays news from all sources.
         */
        async function fetchNews() {
            console.log('Fetching latest news...');
            if (todaysArticles.length === 0 && yesterdaysArticles.length === 0) showLoader();

            const fetchPromises = NEWS_SOURCES.map(url => fetch(RSS_PROXY_URL + encodeURIComponent(url)));

            try {
                const results = await Promise.allSettled(fetchPromises);
                let fetchedItems = [];

                for (const result of results) {
                    if (result.status === 'fulfilled' && result.value.ok) {
                        const data = await result.value.json();
                        if (data.status === 'ok' && data.items) {
                            const sourceTitle = data.feed.title || 'Unknown Source';
                            fetchedItems.push(...data.items.map(item => ({...item, source: sourceTitle })));
                        }
                    } else {
                        console.error('A fetch promise failed:', result.reason || (result.value && result.value.url));
                    }
                }
                
                fetchedItems.sort((a, b) => new Date(b.pubDate) - new Date(a.pubDate));

                const seenTitles = new Set();
                const uniqueArticles = fetchedItems.filter(article => {
                    const normalizedTitle = article.title.toLowerCase().replace(/[^a-z0-9]/g, '').substring(0, 50);
                    if (seenTitles.has(normalizedTitle)) return false;
                    seenTitles.add(normalizedTitle);
                    return true;
                });

                // --- Corrected Timezone Logic ---
                // Get the current time in IST to ensure consistency across all devices.
                const nowInIST = new Date(new Date().toLocaleString("en-US", {timeZone: "Asia/Kolkata"}));
                const twentyFourHoursAgo = new Date(nowInIST.getTime() - 24 * 60 * 60 * 1000);
                const fortyEightHoursAgo = new Date(nowInIST.getTime() - 48 * 60 * 60 * 1000);

                todaysArticles = uniqueArticles.filter(article => new Date(article.pubDate) >= twentyFourHoursAgo);
                yesterdaysArticles = uniqueArticles.filter(article => {
                    const articleDate = new Date(article.pubDate);
                    return articleDate >= fortyEightHoursAgo && articleDate < twentyFourHoursAgo;
                });

                renderAllNews();
                updateTimestamp();

            } catch (error) {
                console.error("A critical error occurred during fetch:", error);
            } finally {
                hideLoader();
            }
        }

        /**
         * Renders both today's and yesterday's news based on the current search term.
         */
        function renderAllNews() {
            const render = (feedElement, articles) => {
                feedElement.innerHTML = ''; // Clear the feed
                const filteredArticles = articles.filter(article => 
                    article.title.toLowerCase().includes(searchTerm) || 
                    cleanDescription(article.description).toLowerCase().includes(searchTerm)
                );

                if (filteredArticles.length === 0) {
                    if (searchTerm) {
                        feedElement.innerHTML = `<div class="text-center text-gray-500 bg-white p-6 rounded-lg shadow-md">No news found matching your search.</div>`;
                    } else {
                        if(feedElement.id === 'news-feed') {
                           feedElement.innerHTML = `<div class="text-center text-gray-500 bg-white p-6 rounded-lg shadow-md">No recent news found. Check back later!</div>`;
                        }
                    }
                    return;
                }
                filteredArticles.forEach(article => feedElement.appendChild(createArticleElement(article)));
            };

            render(newsFeed, todaysArticles);
            render(yesterdayNewsFeed, yesterdaysArticles);
        }
        
        /**
         * Creates an HTML element for a single news article.
         * @param {object} article - The article data.
         * @returns {HTMLElement} The created article element.
         */
        function createArticleElement(article) {
            const articleElement = document.createElement('article');
            articleElement.id = article.guid || article.link;
            articleElement.className = 'bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300 flex items-start space-x-4';

            const description = cleanDescription(article.description);
            const category = getArticleCategory(article);
            const isBreaking = /\bbreaking\b/i.test(article.title);
            
            let imageUrl = article.thumbnail;
            if (!imageUrl) {
                const parser = new DOMParser();
                const doc = parser.parseFromString(article.description, 'text/html');
                const firstImg = doc.querySelector('img');
                if (firstImg) imageUrl = firstImg.src;
            }
            
            const pubDate = new Date(article.pubDate);
            const istDateString = pubDate.toLocaleDateString('en-IN', { timeZone: 'Asia/Kolkata', dateStyle: 'long' });

            const customMessage = 'Breaking news updates from top News portals in the world together in one place.';
            const pageUrl = window.location.href;
            const articleTitle = article.title;
            const articleLink = article.link;
            const shareText = encodeURIComponent(`${customMessage}\n\n*${articleTitle}*\n${articleLink}\n\nSee more at: ${pageUrl}`);
            const whatsappUrl = `https://wa.me/?text=${shareText}`;

            let imageHtml = (imageUrl && typeof imageUrl === 'string' && imageUrl.length > 0)
                ? `<div class="flex-shrink-0"><img src="${imageUrl}" alt="News thumbnail" class="w-24 h-24 object-cover rounded-md" onerror="this.onerror=null; this.parentElement.innerHTML = createFallbackIcon();"></div>`
                : `<div class="flex-shrink-0">${createFallbackIcon()}</div>`;

            const contentHtml = `
                <div class="flex-grow">
                    ${isBreaking ? '<span class="bg-red-500 text-white text-xs font-bold mr-2 px-2.5 py-0.5 rounded-full animate-pulse">BREAKING NEWS</span>' : ''}
                    <a href="${article.link}" target="_blank" rel="noopener noreferrer">
                        <h2 class="text-xl font-bold mt-2 mb-2 text-gray-800 hover:text-blue-600 transition-colors duration-300">${article.title}</h2>
                    </a>
                    <p class="text-gray-600 mb-4">${description}</p>
                    <div class="flex justify-between items-center text-sm text-gray-500">
                        <span class="font-semibold text-gray-700">${article.source.split(' - ')[0]}</span>
                        <div class="flex items-center space-x-4">
                            <a href="${whatsappUrl}" target="_blank" rel="noopener noreferrer" class="text-green-500 hover:text-green-600" title="Share on WhatsApp">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.894 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.886-.003 2.011.564 3.963 1.648 5.684l.269.448-1.125 4.105 4.088-1.079.456.262z"/></svg>
                            </a>
                            <a href="${article.link}" target="_blank" rel="noopener noreferrer" class="font-semibold text-blue-500 hover:underline">Read More &rarr;</a>
                        </div>
                    </div>
                     <div class="flex items-center justify-between mt-2">
                        <div class="text-xs font-medium text-blue-600 bg-blue-100 inline-block px-2 py-1 rounded-full">
                            <span>${category}</span>
                        </div>
                        <div class="text-xs text-gray-500">
                            <span>${istDateString}</span>
                        </div>
                     </div>
                </div>`;
            
            articleElement.innerHTML = imageHtml + contentHtml;
            return articleElement;
        }

        function getArticleCategory(article) {
            const title = article.title.toLowerCase();
            const description = cleanDescription(article.description).toLowerCase();
            const content = title + ' ' + description;
            const link = article.link.toLowerCase();
            const categories = (article.categories || []).map(c => c.toLowerCase());
            
            const check = (keywords) => {
                const regex = new RegExp(`\\b(${keywords.join('|')})\\b`, 'i');
                return regex.test(content) || keywords.some(kw => link.includes(kw) || categories.includes(kw));
            };
            
            const lifieKeywords = ['movie', 'music', 'travel', 'entertainment', 'art', 'painting', 'food', 'science', 'space', 'ai', 'technology', 'film', 'bollywood', 'hollywood', 'celebrity', 'book', 'gadget', 'crypto', 'smartphone', 'review', 'recipe', 'exhibition'];
            const businessKeywords = ['business', 'stock', 'market', 'finance', 'tax', 'investment', 'economy', 'tariff', 'trade war', 'sensex', 'nifty', 'startup', 'ipo'];
            const sportsKeywords = ['sport', 'cricket', 'football', 'ipl', 'olympic', 'tennis', 'f1', 'hockey', 'athlete', 'match'];

            if (/\bkerala\b/i.test(content)) return 'Kerala Related';
            if (/\bindia\b/i.test(content)) return 'India Related';
            if (check(businessKeywords)) return 'Business';
            if (check(sportsKeywords)) return 'Sports';
            if (check(lifieKeywords)) return 'Lifie';
            
            return 'News';
        }

        function createFallbackIcon() {
            return `<div class="w-24 h-24 bg-gray-200 flex items-center justify-center rounded-md">
                        <svg class="w-10 h-10 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 7.5h1.5m-1.5 3h1.5m-7.5 3h7.5m-7.5 3h7.5m3-9h3.375c.621 0 1.125.504 1.125 1.125V18a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 18V6.375c0-.621.504-1.125 1.125-1.125H9.75" />
                        </svg>
                    </div>`;
        }

        function cleanDescription(htmlString) {
            if (!htmlString) return '';
            const parser = new DOMParser();
            const doc = parser.parseFromString(htmlString, 'text/html');
            let text = doc.body.textContent || "";
            return text.trim().substring(0, 150) + (text.length > 150 ? '...' : '');
        }
        
        function updateTimestamp() {
            lastUpdatedElement.textContent = `Last updated: ${new Date().toLocaleTimeString()}`;
        }
        
        function showLoader() {
            loader.style.display = 'flex';
        }

        function hideLoader() {
            loader.style.display = 'none';
        }
        
        function initialize() {
            searchInput.addEventListener('input', (e) => {
                searchTerm = e.target.value.toLowerCase();
                renderAllNews();
            });

            toggleYesterdayBtn.addEventListener('click', (e) => {
                e.preventDefault();
                const isHidden = yesterdayContainer.classList.toggle('hidden');
                e.target.textContent = isHidden ? 'What we shared Yesterday' : "Hide Yesterday's News";
            });

            fetchNews();
            setInterval(fetchNews, REFRESH_INTERVAL);
        }

        initialize();
    </script>

</body>
</html>
