<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>12to12 News Radar</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Custom Styles -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #e0f2fe;
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        /* Simple spinner animation */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #09f;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Styles for active and inactive category tabs */
        .category-btn {
            transition: all 0.3s ease;
        }
        .category-btn.active {
            background-color: #007bff;
            color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="antialiased text-gray-800">

    <!-- Main Container -->
    <div class="container mx-auto p-4 md:p-8 max-w-4xl">

        <!-- Header Section -->
        <header class="mb-8 text-center">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-2">12to12 News Radar</h1>
            <p class="text-gray-600">Today's global headlines, updated every minute.</p>
            <div id="last-updated" class="text-sm text-gray-500 mt-2"></div>
        </header>

        <!-- Category Filters -->
        <div id="category-filters" class="flex flex-wrap justify-center gap-2 mb-8">
            <button class="category-btn active bg-white text-gray-700 font-semibold py-2 px-4 rounded-full shadow-sm" data-category="All">ALL</button>
            <button class="category-btn bg-white text-gray-700 font-semibold py-2 px-4 rounded-full shadow-sm" data-category="General">General News</button>
            <button class="category-btn bg-white text-gray-700 font-semibold py-2 px-4 rounded-full shadow-sm" data-category="Business">Business</button>
            <button class="category-btn bg-white text-gray-700 font-semibold py-2 px-4 rounded-full shadow-sm" data-category="Sports">Sports</button>
            <button class="category-btn bg-white text-gray-700 font-semibold py-2 px-4 rounded-full shadow-sm" data-category="Lifie">LIFIE</button>
        </div>

        <!-- Loading Spinner -->
        <div id="loader" class="flex justify-center items-center py-10">
            <div class="spinner"></div>
        </div>
        
        <!-- News Feed Container -->
        <main id="news-feed" class="space-y-6">
            <!-- News articles will be injected here by JavaScript -->
        </main>

    </div>
    
    <!-- Footer Section -->
    <footer class="text-center py-6">
        <p class="text-sm text-gray-500">Created for Malayala Manorama by Manuel George</p>
    </footer>


    <!-- JavaScript Logic -->
    <script>
        // DOM Element References
        const newsFeed = document.getElementById('news-feed');
        const loader = document.getElementById('loader');
        const lastUpdatedElement = document.getElementById('last-updated');
        const categoryFilters = document.getElementById('category-filters');

        // --- State Management ---
        let allFetchedArticles = [];
        let currentCategory = 'All';

        // --- Configuration ---
        const RSS_PROXY_URL = 'https://api.rss2json.com/v1/api.json?rss_url=';
        const REFRESH_INTERVAL = 60000; // 1 minute

        const NEWS_SOURCES = [
            'http://feeds.reuters.com/Reuters/worldNews', 'http://feeds.bbci.co.uk/news/world/rss.xml', 
            'http://rss.cnn.com/rss/cnn_world.rss', 'https://www.france24.com/en/rss', 
            'http://hosted.ap.org/lineups/WORLDHEADS-rss_2.0.xml?SITE=AP&SECTION=HOME', 'https://www.theguardian.com/world/rss', 
            'https://news.google.com/rss?hl=en-IN&gl=IN&ceid=IN:en', 'http://feeds.nbcnews.com/nbcnews/public/world',
            'https://timesofindia.indiatimes.com/rssfeeds/296589292.cms', 'https://www.hindustantimes.com/feeds/rss/india-news/rssfeed.xml',
            'https://feeds.feedburner.com/ndtvnews-top-stories', 'https://www.thehindu.com/feeder/default.rss',
            'https://www.indiatoday.in/rss/home', 'https://indianexpress.com/section/india/feed/',
            'https://www.news18.com/rss/india.xml', 'https://economictimes.indiatimes.com/rssfeedstopstories.cms',
            'https://www.livemint.com/rss/news', 'https://feeds.feedburner.com/ndtvprofit-latest'
        ];

        /**
         * Fetches news and stores it, then triggers a render.
         */
        async function fetchNews() {
            console.log('Fetching latest news...');
            if (allFetchedArticles.length === 0) showLoader();

            const fetchPromises = NEWS_SOURCES.map(url => fetch(RSS_PROXY_URL + encodeURIComponent(url)));

            try {
                const results = await Promise.allSettled(fetchPromises);
                let fetchedItems = [];

                for (const result of results) {
                    if (result.status === 'fulfilled' && result.value.ok) {
                        const data = await result.value.json();
                        if (data.status === 'ok' && data.items) {
                            const sourceTitle = data.feed.title || 'Unknown Source';
                            fetchedItems.push(...data.items.map(item => ({...item, source: sourceTitle })));
                        }
                    } else {
                        console.error('A fetch promise failed:', result.reason || (result.value && result.value.url));
                    }
                }
                
                fetchedItems.sort((a, b) => new Date(b.pubDate) - new Date(a.pubDate));

                const seenTitles = new Set();
                const uniqueArticles = fetchedItems.filter(article => {
                    const normalizedTitle = article.title.toLowerCase().replace(/[^a-z0-9]/g, '').substring(0, 50);
                    if (seenTitles.has(normalizedTitle)) return false;
                    seenTitles.add(normalizedTitle);
                    return true;
                });

                const now = new Date();
                const todayStart = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 0, 0, 0);
                const todayEnd = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23, 59, 59);

                allFetchedArticles = uniqueArticles.filter(article => {
                    const articleDate = new Date(article.pubDate);
                    return articleDate >= todayStart && articleDate <= todayEnd;
                });

                renderNews();
                updateTimestamp();

            } catch (error) {
                console.error("A critical error occurred during fetch:", error);
            } finally {
                hideLoader();
            }
        }

        /**
         * Renders news based on the current category without scrolling to the top.
         */
        function renderNews() {
            let articlesToRender;
            if (currentCategory === 'All') {
                articlesToRender = allFetchedArticles;
            } else {
                articlesToRender = allFetchedArticles.filter(article => getArticleCategory(article, true) === currentCategory);
            }

            if (articlesToRender.length === 0 && currentCategory !== 'All') {
                 newsFeed.innerHTML = `<div class="text-center text-gray-500 bg-white p-6 rounded-lg shadow-md">No news found for the "${currentCategory}" category today.</div>`;
                 return;
            } else if (allFetchedArticles.length === 0) {
                 newsFeed.innerHTML = `<div class="text-center text-gray-500 bg-white p-6 rounded-lg shadow-md">No news found for today yet. Check back later!</div>`;
                 return;
            }

            const existingArticleIds = new Set([...newsFeed.children].map(child => child.id));
            const articlesToRenderIds = new Set(articlesToRender.map(article => article.guid || article.link));

            articlesToRender.forEach(article => {
                const articleId = article.guid || article.link;
                if (!existingArticleIds.has(articleId)) {
                    const articleElement = createArticleElement(article);
                    newsFeed.prepend(articleElement);
                }
            });

            [...newsFeed.children].forEach(child => {
                if (!articlesToRenderIds.has(child.id)) {
                    child.remove();
                }
            });
        }
        
        /**
         * Creates an HTML element for a single news article.
         * @param {object} article - The article data.
         * @returns {HTMLElement} The created article element.
         */
        function createArticleElement(article) {
            const articleElement = document.createElement('article');
            articleElement.id = article.guid || article.link;
            articleElement.className = 'bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300 flex items-start space-x-4';

            const description = cleanDescription(article.description);
            const category = getArticleCategory(article);
            
            let imageUrl = article.thumbnail;
            if (!imageUrl) {
                const parser = new DOMParser();
                const doc = parser.parseFromString(article.description, 'text/html');
                const firstImg = doc.querySelector('img');
                if (firstImg) imageUrl = firstImg.src;
            }
            
            const pubDate = new Date(article.pubDate);
            const istDateString = pubDate.toLocaleDateString('en-IN', { timeZone: 'Asia/Kolkata', dateStyle: 'long' });

            let imageHtml = (imageUrl && typeof imageUrl === 'string' && imageUrl.length > 0)
                ? `<div class="flex-shrink-0"><img src="${imageUrl}" alt="News thumbnail" class="w-24 h-24 object-cover rounded-md" onerror="this.onerror=null; this.parentElement.innerHTML = createFallbackIcon();"></div>`
                : `<div class="flex-shrink-0">${createFallbackIcon()}</div>`;

            const contentHtml = `
                <div class="flex-grow">
                    <a href="${article.link}" target="_blank" rel="noopener noreferrer">
                        <h2 class="text-xl font-bold mb-2 text-gray-800 hover:text-blue-600 transition-colors duration-300">${article.title}</h2>
                    </a>
                    <p class="text-gray-600 mb-4">${description}</p>
                    <div class="flex justify-between items-center text-sm text-gray-500">
                        <span class="font-semibold text-gray-700">${article.source.split(' - ')[0]}</span>
                        <a href="${article.link}" target="_blank" rel="noopener noreferrer" class="font-semibold text-blue-500 hover:underline">Read More &rarr;</a>
                    </div>
                     <div class="flex items-center justify-between mt-2">
                        <div class="text-xs font-medium text-blue-600 bg-blue-100 inline-block px-2 py-1 rounded-full">
                            <span>${category}</span>
                        </div>
                        <div class="text-xs text-gray-500">
                            <span>${istDateString}</span>
                        </div>
                     </div>
                </div>`;
            
            articleElement.innerHTML = imageHtml + contentHtml;
            return articleElement;
        }

        /**
         * Determines the category of an article based on new, specific rules.
         * @param {object} article - The article object.
         * @param {boolean} forFilter - If true, returns a simplified category for tab filtering.
         * @returns {string} The determined category.
         */
        function getArticleCategory(article, forFilter = false) {
            const title = article.title.toLowerCase();
            const description = cleanDescription(article.description).toLowerCase();
            const content = title + ' ' + description;
            const link = article.link.toLowerCase();
            const categories = (article.categories || []).map(c => c.toLowerCase());
            const check = (keywords) => keywords.some(kw => content.includes(kw) || link.includes(kw) || categories.includes(kw));
            
            const lifieKeywords = ['movie', 'music', 'travel', 'entertainment', 'art', 'painting', 'life', 'food', 'science', 'space', 'ai', 'technology', 'book', 'film', 'bollywood', 'hollywood', 'celebrity', 'gadget', 'crypto', 'smartphone'];
            const businessKeywords = ['business', 'stock', 'market', 'finance', 'tax', 'investment', 'economy', 'tariff', 'trade war'];
            const sportsKeywords = ['sport', 'cricket', 'football', 'ipl', 'olympic', 'tennis'];
            const generalKeywords = ['politics', 'government', 'international relations', 'war', 'election'];

            // This logic determines which TAB the article belongs to.
            if (forFilter) {
                if (check(businessKeywords)) return 'Business';
                if (check(sportsKeywords)) return 'Sports';
                if (check(lifieKeywords)) return 'Lifie';
                // Everything else falls under General for filtering purposes.
                return 'General';
            }

            // This logic determines the LABEL displayed on the article card.
            if (/\bkerala\b/.test(content)) return 'Kerala Related';
            if (/\bindia\b/.test(content)) return 'India Related';
            if (check(businessKeywords)) return 'Business';
            if (check(sportsKeywords)) return 'Sports';
            if (check(lifieKeywords)) return 'Lifie';
            if (check(generalKeywords)) return 'General News';
            
            return 'News';
        }

        function createFallbackIcon() {
            return `<div class="w-24 h-24 bg-gray-200 flex items-center justify-center rounded-md">
                        <svg class="w-10 h-10 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 7.5h1.5m-1.5 3h1.5m-7.5 3h7.5m-7.5 3h7.5m3-9h3.375c.621 0 1.125.504 1.125 1.125V18a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 18V6.375c0-.621.504-1.125 1.125-1.125H9.75" />
                        </svg>
                    </div>`;
        }

        function cleanDescription(htmlString) {
            if (!htmlString) return '';
            const parser = new DOMParser();
            const doc = parser.parseFromString(htmlString, 'text/html');
            let text = doc.body.textContent || "";
            return text.trim().substring(0, 150) + (text.length > 150 ? '...' : '');
        }
        
        function updateTimestamp() {
            lastUpdatedElement.textContent = `Last updated: ${new Date().toLocaleTimeString()}`;
        }

        function showLoader() {
            loader.style.display = 'flex';
        }

        function hideLoader() {
            loader.style.display = 'none';
        }
        
        function initialize() {
            categoryFilters.addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON') {
                    categoryFilters.querySelector('.active').classList.remove('active');
                    e.target.classList.add('active');
                    currentCategory = e.target.dataset.category;
                    newsFeed.innerHTML = ''; 
                    renderNews();
                }
            });

            fetchNews();
            setInterval(fetchNews, REFRESH_INTERVAL);
        }

        initialize();
    </script>

</body>
</html>
